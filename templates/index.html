<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulse | Önemli Haberler</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Dark Mode (Default) */
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #38bdf8;
            --accent-glow: rgba(56, 189, 248, 0.3);
            --gradient: linear-gradient(135deg, #38bdf8 0%, #818cf8 100%);
            --border-color: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(255, 255, 255, 0.05);
        }

        [data-theme="light"] {
            --bg-color: #f8fafc;
            --card-bg: rgba(255, 255, 255, 0.8);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent: #0ea5e9;
            --accent-glow: rgba(14, 165, 233, 0.2);
            --gradient: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
            --border-color: rgba(0, 0, 0, 0.1);
            --input-bg: rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            background-image:
                radial-gradient(circle at 10% 20%, var(--accent-glow) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, var(--accent-glow) 0%, transparent 40%);
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        header {
            padding: 40px 20px;
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: var(--border-color);
            transform: rotate(15deg);
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: -1px;
            text-shadow: 0 10px 30px var(--accent-glow);
        }

        /* ... (Keep existing styles for subtitle, container, controls, etc. but use variables) ... */
        /* I will only replace the parts that need variable updates or new styles */

        .filter-btn {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            /* ... other styles ... */
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            /* ... */
        }

        .card:hover {
            border-color: var(--accent);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            /* Softer shadow for light mode compatibility */
        }

        .card-footer {
            border-top: 1px solid var(--border-color);
        }

        #search-input {
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-primary);
        }

        #search-input:focus {
            background: var(--input-bg);
        }

        .bookmark-btn {
            border: 1px solid rgba(255, 255, 255, 0.2);
            /* Keep white border for image overlay */
        }

        .share-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            font-family: inherit;
            font-weight: 600;
        }

        .share-btn:hover {
            color: var(--accent);
        }

        /* Auto Refresh Toggle */
        .auto-refresh-container {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
        }

        input:checked+.slider {
            background-color: var(--accent);
        }

        input:checked+.slider:before {
            transform: translateX(18px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Mobile Optimization */
        @media (max-width: 768px) {

            /* ... existing mobile styles ... */
            .auto-refresh-container {
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
        }
    </style>
</head>

<body>
    <header>
        <button class="theme-toggle" onclick="toggleTheme()" title="Temayı Değiştir">
            <!-- Icon will be set by JS -->
            <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </button>
        <h1>Pulse</h1>
        <div class="subtitle">Seçilmiş Önemli Haber Kaynağı</div>
    </header>

    <!-- ... Container ... -->

    <script>
        // ... existing vars ...
        let allNews = [];
        let bookmarks = JSON.parse(localStorage.getItem('pulse_bookmarks') || '[]');
        let currentCategory = 'Tümü';

        // Theme Logic
        const savedTheme = localStorage.getItem('pulse_theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('pulse_theme', next);
            updateThemeIcon(next);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('theme-icon');
            if (theme === 'dark') {
                // Sun icon
                icon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
            } else {
                // Moon icon
                icon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
            }
        }

        // ... existing fetchNews ...

        function renderNews(newsItems) {
            const grid = document.getElementById('news-grid');
            grid.innerHTML = '';

            if (newsItems.length === 0) {
                grid.innerHTML = '<div class="loading">Haber bulunamadı.</div>';
                return;
            }

            newsItems.forEach((item, index) => {
                const isBookmarked = bookmarks.some(b => b.link === item.link);
                const card = document.createElement('div');
                card.className = 'card';
                card.style.animationDelay = `${index * 0.05}s`;

                const bgImage = item.image ? `url('${item.image}')` : 'linear-gradient(45deg, #1e293b, #334155)';

                card.innerHTML = `
                    <div class="card-image" style="background-image: ${bgImage}">
                        <div class="category-tag">${item.category}</div>
                        <button class="bookmark-btn ${isBookmarked ? 'active' : ''}" onclick="toggleBookmark('${item.link}', this)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="${isBookmarked ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="source">${item.source}</div>
                        <div class="card-summary" style="font-size: 1.1rem; font-weight: 500; color: var(--text-primary);">${stripHtml(item.summary)}</div>
                        <div class="card-footer">
                            <button class="share-btn" onclick="shareNews('${item.title}', '${item.link}')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                                Paylaş
                            </button>
                            <a href="${item.link}" target="_blank" class="read-more">Haberi Oku &rarr;</a>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        async function shareNews(title, url) {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Pulse Haber',
                        text: title,
                        url: url
                    });
                } catch (err) {
                    console.log('Share canceled');
                }
            } else {
                // Fallback to clipboard
                navigator.clipboard.writeText(url).then(() => {
                    alert('Link kopyalandı!');
                });
            }
        }

        // ... existing functions ...

        .subtitle {
            color: var(--text - secondary);
            font - size: 1.1rem;
            font - weight: 300;
        }

        .container {
            max - width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Search & Controls */
        .controls {
            display: flex;
            justify - content: space - between;
            align - items: center;
            gap: 20px;
            margin - bottom: 40px;
            flex - wrap: wrap;
        }

        .search - container {
            position: relative;
            flex - grow: 1;
            max - width: 400px;
        }

        #search - input {
            width: 100 %;
            padding: 12px 20px 12px 45px;
            border - radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font - family: inherit;
            font - size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            backdrop - filter: blur(10px);
        }

        #search - input:focus {
            background: rgba(255, 255, 255, 0.1);
            border - color: var(--accent);
            box - shadow: 0 0 15px var(--accent - glow);
        }

        .search - icon {
            position: absolute;
            left: 15px;
            top: 50 %;
            transform: translateY(-50 %);
            color: var(--text - secondary);
            pointer - events: none;
        }

        .filter - group {
            display: flex;
            gap: 10px;
            flex - wrap: wrap;
            justify - content: center;
        }

        .filter - btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border - radius: 30px;
            color: var(--text - secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font - family: inherit;
            font - weight: 600;
            backdrop - filter: blur(10px);
            display: flex;
            align - items: center;
            gap: 8px;
        }

        .filter - btn: hover,
        .filter - btn.active {
            background: var(--gradient);
            color: white;
            border - color: transparent;
            box - shadow: 0 5px 15px var(--accent - glow);
            transform: translateY(-2px);
        }

        .special - btn {
            border - color: var(--accent);
            color: var(--accent);
        }

        .special - btn: hover,
        .special - btn.active {
            background: var(--accent);
            color: #0f172a;
        }

        /* Bookmark Button */
        .bookmark - btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            width: 36px;
            height: 36px;
            border - radius: 50 %;
            display: flex;
            align - items: center;
            justify - content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop - filter: blur(5px);
            z - index: 20;
        }

        .bookmark - btn:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.2);
        }

        .bookmark - btn.active {
            background: var(--accent);
            border - color: var(--accent);
            color: white;
        }
    </style >

    .grid {
            display: grid;
            grid - template - columns: repeat(auto - fill, minmax(350px, 1fr));
            gap: 30px;
        }

    .card {
            background: var(--card - bg);
            border - radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic - bezier(0.175, 0.885, 0.32, 1.275);
            backdrop - filter: blur(10px);
            display: flex;
            flex - direction: column;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s forwards;
        }

        @keyframes fadeInUp {
    to {
                opacity: 1;
                transform: translateY(0);
            }
        }

    .card:hover {
            transform: translateY(-10px) scale(1.02);
            box - shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border - color: rgba(255, 255, 255, 0.2);
            z - index: 10;
        }

    .card - image {
            height: 200px;
            background - color: #1e293b;
            background - size: cover;
            background - position: center;
            position: relative;
        }

    .card - image::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50 %;
            background: linear - gradient(to top, var(--card - bg), transparent);
        }

    .category - tag {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.6);
            padding: 5px 12px;
            border - radius: 12px;
            font - size: 0.8rem;
            font - weight: 600;
            color: white;
            backdrop - filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

    .card - content {
            padding: 25px;
            flex - grow: 1;
            display: flex;
            flex - direction: column;
        }

    .source {
            color: var(--accent);
            font - size: 0.85rem;
            font - weight: 600;
            text - transform: uppercase;
            letter - spacing: 1px;
            margin - bottom: 10px;
        }

    .card - title {
            font - size: 1.4rem;
            font - weight: 700;
            margin - bottom: 15px;
            line - height: 1.3;
        }

    .card - title a {
            color: var(--text - primary);
            text - decoration: none;
            transition: color 0.2s;
        }

    .card - title a:hover {
            color: var(--accent);
        }

    .card - summary {
            color: var(--text - secondary);
            font - size: 0.95rem;
            line - height: 1.6;
            margin - bottom: 20px;
            flex - grow: 1;
        }

    .card - footer {
            display: flex;
            justify - content: space - between;
            align - items: center;
            padding - top: 20px;
            border - top: 1px solid rgba(255, 255, 255, 0.05);
            font - size: 0.85rem;
            color: var(--text - secondary);
        }

    .read - more {
            color: white;
            text - decoration: none;
            font - weight: 600;
            display: flex;
            align - items: center;
            gap: 5px;
            transition: gap 0.2s;
        }

    .read - more:hover {
            gap: 8px;
            color: var(--accent);
        }

    .loading {
            text - align: center;
            padding: 50px;
            font - size: 1.2rem;
            color: var(--text - secondary);
        }

    /* Scrollbar */
    :: -webkit - scrollbar {
            width: 8px;
        }

    :: -webkit - scrollbar - track {
            background: var(--bg - color);
        }

    :: -webkit - scrollbar - thumb {
            background: #334155;
            border - radius: 4px;
        }

    :: -webkit - scrollbar - thumb:hover {
            background: #475569;
        }
        /* Mobile Optimization */
        @media(max - width: 768px) {
            h1 {
                font - size: 2.5rem;
            }

            .subtitle {
                font - size: 1rem;
            }

            .controls {
                flex - direction: column;
                gap: 15px;
            }

            .search - container {
                max - width: 100 %;
                width: 100 %;
            }

            .filter - group {
                width: 100 %;
                justify - content: flex - start;
                overflow - x: auto;
                padding - bottom: 10px;
                -webkit - overflow - scrolling: touch; /* Smooth scroll on iOS */
                flex - wrap: nowrap; /* Horizontal scroll */
            }

            .filter - btn {
                flex - shrink: 0; /* Prevent shrinking */
                padding: 8px 16px;
                font - size: 0.9rem;
            }

            .grid {
                grid - template - columns: 1fr; /* Single column on mobile */
                gap: 20px;
            }

            .card:hover {
                transform: none; /* Disable hover lift on touch */
            }
            
            .theme - toggle {
                top: 15px;
                right: 15px;
                width: 36px;
                height: 36px;
            }
        }

        /* Scrollbar for horizontal filter */
        .filter - group:: -webkit - scrollbar {
            height: 4px;
        }

        .filter - group:: -webkit - scrollbar - track {
            background: transparent;
        }

        .filter - group:: -webkit - scrollbar - thumb {
            background: rgba(255, 255, 255, 0.1);
            border - radius: 4px;
        }
    </style >
</head >

            <body>
                <header>
                    <h1>Pulse</h1>
                    <div class="subtitle">Seçilmiş Önemli Haber Kaynağı</div>
                </header>

                <div class="container">
                    <div class="controls">
                        <div class="search-container">
                            <input type="text" id="search-input" placeholder="Haberlerde ara..." oninput="handleSearch()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn active" onclick="filterNews('Tümü')">Tümü</button>
                            <button class="filter-btn" onclick="filterNews('Gündem')">Gündem</button>
                            <button class="filter-btn" onclick="filterNews('Dünya')">Dünya</button>
                            <button class="filter-btn" onclick="filterNews('Teknoloji')">Teknoloji</button>
                            <button class="filter-btn" onclick="filterNews('Ekonomi')">Ekonomi</button>
                            <button class="filter-btn" onclick="filterNews('Bilim')">Bilim</button>
                            <button class="filter-btn special-btn" onclick="filterNews('Kaydedilenler')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
                                Kaydedilenler
                            </button>
                        </div>
                        <div class="auto-refresh-container">
                            <label class="switch">
                                <input type="checkbox" id="auto-refresh-toggle" onchange="toggleAutoRefresh()">
                                    <span class="slider round"></span>
                            </label>
                            <span class="refresh-label">Otomatik Yenile</span>
                        </div>
                    </div>

                    <div id="news-grid" class="grid">
                        <div class="loading">Haberler yükleniyor...</div>
                    </div>

                    <div id="load-more-container" style="text-align: center; margin-top: 40px; display: none;">
                        <button class="filter-btn" onclick="loadMore()" style="background: var(--accent); color: #0f172a; border: none; padding: 12px 30px;">Daha Fazla Yükle</button>
                    </div>
                </div>

                <script>
                    let allNews = [];
                    let displayedNews = [];
                    let bookmarks = JSON.parse(localStorage.getItem('pulse_bookmarks') || '[]');
                    let currentCategory = 'Tümü';
                    let currentPage = 1;
                    const ITEMS_PER_PAGE = 9;
                    let refreshInterval;

                    // Theme Logic
                    const savedTheme = localStorage.getItem('pulse_theme') || 'dark';
                    document.documentElement.setAttribute('data-theme', savedTheme);
                    updateThemeIcon(savedTheme);

                    function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
                    const next = current === 'dark' ? 'light' : 'dark';
                    document.documentElement.setAttribute('data-theme', next);
                    localStorage.setItem('pulse_theme', next);
                    updateThemeIcon(next);
        }

                    function updateThemeIcon(theme) {
            const icon = document.getElementById('theme-icon');
                    if (theme === 'dark') {
                        icon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
            } else {
                        icon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
            }
        }

                    async function fetchNews(isRefresh = false) {
            try {
                const response = await fetch('/api/news');
                    const newData = await response.json();

                // Add unique IDs
                allNews = newData.map(item => ({...item, id: item.link}));

                    if (isRefresh) {
                        // If refreshing, keep current category but reset page if needed or just update data
                        // For simplicity, we'll re-apply filters which resets the view
                        applyFilters(true);
                    console.log('Auto-refreshed news');
                } else {
                        applyFilters();
                }
            } catch (error) {
                if (!isRefresh) {
                        document.getElementById('news-grid').innerHTML = '<div class="loading">Haberler yüklenirken hata oluştu. Lütfen tekrar deneyin.</div>';
                }
                    console.error('Error:', error);
            }
        }

                    function renderNews(newsItems, append = false) {
            const grid = document.getElementById('news-grid');
                    const loadMoreBtn = document.getElementById('load-more-container');

                    if (!append) {
                        grid.innerHTML = '';
            }

                    if (newsItems.length === 0 && !append) {
                        grid.innerHTML = '<div class="loading">Haber bulunamadı.</div>';
                    loadMoreBtn.style.display = 'none';
                    return;
            }

            newsItems.forEach((item, index) => {
                const isBookmarked = bookmarks.some(b => b.link === item.link);
                    const card = document.createElement('div');
                    card.className = 'card';
                    // Reset animation for appended items
                    card.style.animation = 'none';
                    card.offsetHeight; /* trigger reflow */
                    card.style.animation = `fadeInUp 0.6s forwards ${index * 0.05}s`;

                    const bgImage = item.image ? `url('${item.image}')` : 'linear-gradient(45deg, #1e293b, #334155)';

                    card.innerHTML = `
                    <div class="card-image" style="background-image: ${bgImage}">
                        <div class="category-tag">${item.category}</div>
                        <button class="bookmark-btn ${isBookmarked ? 'active' : ''}" onclick="toggleBookmark('${item.link}', this)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="${isBookmarked ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="source">${item.source}</div>
                        <div class="card-summary" style="font-size: 1.1rem; font-weight: 500; color: var(--text-primary);">${stripHtml(item.summary)}</div>
                        <div class="card-footer">
                            <button class="share-btn" onclick="shareNews('${item.title}', '${item.link}')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                                Paylaş
                            </button>
                            <a href="${item.link}" target="_blank" class="read-more">Haberi Oku &rarr;</a>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function handleSearch() {
            currentPage = 1;
            applyFilters();
        }

        function filterNews(category) {
            currentCategory = category;
            currentPage = 1;

            // Update buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.innerText.includes(category)) btn.classList.add('active');
            });

            applyFilters();
        }

        function applyFilters(preserveView = false) {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            let filtered = allNews;

            // 1. Filter by Category
            if (currentCategory === 'Kaydedilenler') {
                filtered = bookmarks;
            } else if (currentCategory !== 'Tümü') {
                filtered = allNews.filter(item => item.category === currentCategory);
            }

            // 2. Filter by Search
            if (searchTerm) {
                filtered = filtered.filter(item =>
                    (item.title && item.title.toLowerCase().includes(searchTerm)) ||
                    (item.summary && item.summary.toLowerCase().includes(searchTerm)) ||
                    (item.source && item.source.toLowerCase().includes(searchTerm))
                );
            }

            displayedNews = filtered;

            // Pagination Logic
            const totalItems = displayedNews.length;
            const itemsToShow = displayedNews.slice(0, currentPage * ITEMS_PER_PAGE);

            renderNews(itemsToShow, false);

            // Show/Hide Load More Button
            const loadMoreBtn = document.getElementById('load-more-container');
            if (itemsToShow.length < totalItems) {
                loadMoreBtn.style.display = 'block';
            } else {
                loadMoreBtn.style.display = 'none';
            }
        }

        function loadMore() {
            currentPage++;
            const start = (currentPage - 1) * ITEMS_PER_PAGE;
            const end = currentPage * ITEMS_PER_PAGE;
            const newItems = displayedNews.slice(start, end);

            renderNews(newItems, true);

            // Check if we reached the end
            if (end >= displayedNews.length) {
                document.getElementById('load-more-container').style.display = 'none';
            }
        }

        function toggleAutoRefresh() {
            const checkbox = document.getElementById('auto-refresh-toggle');
            if (checkbox.checked) {
                // Refresh every 60 seconds
                refreshInterval = setInterval(() => fetchNews(true), 60000);
            } else {
                clearInterval(refreshInterval);
            }
        }

        function toggleBookmark(link, btn) {
            event.stopPropagation();

            const index = bookmarks.findIndex(b => b.link === link);

            if (index === -1) {
                const item = allNews.find(i => i.link === link);
                if (item) {
                    bookmarks.push(item);
                    btn.classList.add('active');
                    btn.querySelector('svg').setAttribute('fill', 'currentColor');
                }
            } else {
                bookmarks.splice(index, 1);
                btn.classList.remove('active');
                btn.querySelector('svg').setAttribute('fill', 'none');

                if (currentCategory === 'Kaydedilenler') {
                    applyFilters();
                }
            }

            localStorage.setItem('pulse_bookmarks', JSON.stringify(bookmarks));
        }

        function shareNews(title, url) {
            if (navigator.share) {
                try {
                    navigator.share({
                        title: 'Pulse Haber',
                        text: title,
                        url: url
                    });
                } catch (err) {
                    console.log('Share canceled');
                }
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    alert('Link kopyalandı!');
                });
            }
        }

        function stripHtml(html) {
            let tmp = document.createElement("DIV");
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || "";
        }

        // Initial load
        fetchNews();
    </script>
</body>

</html>